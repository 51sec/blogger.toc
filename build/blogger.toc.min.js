/** Copyright (c) 2013-2015 akinari tsugo */
(function(){function k(a){return function(){return a}}function l(a,c){function b(){}b.prototype=c.prototype;a.l=c.prototype;a.prototype=new b};function n(a,c){this.a=a;this.d=c;this.c=null;this.g()}n.prototype.getName=function(){return this.d.title.k};
n.prototype.g=function(){var a=this.a,c=this.d,b=document.createElement("span"),e=document.createElement("span"),d=document.createElement("span"),f=document.createElement("span"),g=document.createElement("a");a.thumbnail.enabled&&(f.appendChild(r(this,c.media$thumbnail)),f.className="poststoc-thumbnail");e.appendChild(document.createTextNode(c.published.$t));e.className="poststoc-published";d.appendChild(document.createTextNode(c.updated.$t));d.className="poststoc-updated";g.appendChild(document.createTextNode(c.title.$t));
g.href=c.link[c.link.length-1].href;g.className="poststoc-title";a.thumbnail.enabled&&b.appendChild(f);b.appendChild(e);b.appendChild(d);b.appendChild(g);b.className="poststoc-entry";this.c=b};function r(a,c){var b=document.createElement("img");c?(b.src=c.url,b.className="poststoc-thumbnail-image"):(b.src=a.a.thumbnail.noImageURL,b.className="poststoc-thumbnail-noimage");return b};function s(a){this.a=a};function t(a){this.a=a}l(t,s);t.prototype.execute=function(a){a=a.entry||[];var c,b,e,d;c=document.createElement("ul");c.className="poststoc-list";e=0;for(d=a.length;e<d;e++)b=document.createElement("li"),b.appendChild(u(this,a[e])),b.className="poststoc-item",c.appendChild(b);return c};function u(a,c){c=new n(a.a,c);return c.c};function v(a,c){this.a=a;this.d=c;this.f=this.j=this.c=null;this.g()}v.prototype.getName=function(){return this.d.term};
v.prototype.g=function(){var a=this.a,c=this.d.term,b=document.createElement("div"),e=document.createElement("div"),d=document.createElement("a"),f=document.createElement("ul"),a="http://"+a.blogURL,a=a+"/search/label/",a=a+c;d.appendChild(document.createTextNode(c));d.href=a;d.className="poststoc-category-anchor";e.appendChild(d);e.className="poststoc-category-title";f.className="poststoc-list";b.appendChild(e);b.appendChild(f);b.className="poststoc-category";this.c=b;this.j=e;this.f=f};function w(a){this.a=a}l(w,s);w.prototype.execute=function(a){var c=this.a,b=a.entry||[];a=a.category||[];var e,d,f,g,m,C,p,D,h,q;g={};m=[];C=document.createDocumentFragment();e=0;for(f=b.length;e<f;e++)for(D=b[e],a=D.category||[],d=a.length;d--;)p=a[d],q=new n(c,D),h=g[p.term],h||(h=new v(c,p),g[p.term]=h,m[m.length]=h),p=q.c,h=h.f,q=document.createElement("li"),q.className="poststoc-item",q.appendChild(p),h.appendChild(q);m=this.sort(m);e=0;for(f=m.length;e<f;e++)C.appendChild(m[e].c);return C};
w.prototype.sort=function(a){return a};function x(a){this.a=a}l(x,w);x.prototype.sort=function(a){return a.sort(function(a,b){return a.f.childNodes.length<b.f.childNodes.length?1:-1})};function y(a){this.a=a}y.prototype.e=k("published");y.prototype.execute=function(){};function z(a){this.a=a}l(z,y);z.prototype.e=k("published");z.prototype.execute=function(){};function A(a){this.a=a}l(A,w);A.prototype.sort=function(a){return a.sort(function(a,b){return a.getName()<b.getName()?-1:1})};function B(){E(this,this,POSTSTOC_SETTINGS,{blogURL:"garafu.blogspot.jp",maxResults:Infinity,orderby:"published",printby:"label",thumbnail:{enabled:!1,noImageURL:"http://garafu.github.io/blogger.toc/release/0.0.4/noimage.png"}})}function E(a,c,b,e){var d;b=b||{};for(d in e)"object"===typeof e[d]?(c[d]=c[d]||{},E(a,c[d],b[d],e[d])):c[d]=void 0!==b[d]?b[d]:e[d]};function F(a,c,b){var e;F=e=window.addEventListener?function(a,b,c){a.addEventListener(b,c,!1)}:window.attachEvent?function(a,b,c){a.attachEvent("on"+b,c)}:function(a,b,c){a["on"+b]=c};e(a,c,b)};function G(a){this.a=a}l(G,y);G.prototype.e=k("published");G.prototype.execute=function(a){(a.entry||[]).sort(function(a,b){return a.title.$t>b.title.$t?1:-1})};function H(a){this.a=a}l(H,y);H.prototype.e=k("updated");H.prototype.execute=function(){};function I(){this.a=new B;this.h=J(this);this.i=K(this);this.b=0;L(this)}var M="__garafu.blogger.toc__"+(new Date).getTime(),N=null,contract=contract||void 0,O=contract;function P(){var a=N;a||(N=a=new I);return a}
function L(a){var c,b,e;c=a.b+1;e=a.b+500<a.a.maxResults?a.b+500:a.a.maxResults-a.b;var d=a.a;b=a.h;d="http://"+d.blogURL;d+="/feeds/posts/summary?";d+="redirect=false&";d+="start-index="+c+"&";d+="max-results="+e+"&";d+="orderby="+b.e()+"&";d+="alt=json-in-script&";d+="callback=";c=d+="garafu.blogger.toc.load";b=document.createElement("script");b.src=c;b.type="text/javascript";document.body.appendChild(b);a.b=e}I.prototype.sort=function(a){this.h.execute(a.feed||{})};
I.prototype.print=function(a){a=this.i.execute(a.feed||{});var c=document.createElement("div"),b=document.createElement("a");document.createElement("a");document.createElement("a");b.href="https://github.com/garafu/blogger.toc";b.appendChild(document.createTextNode('This page uses "blogger.toc" created by garafu.'));c.appendChild(b);c.style.display="block";c.style.fontSize="small";c.style.margin="20px 0";a.appendChild(c);document.getElementById(M).appendChild(a)};
function J(a){a=a.a;switch(a.orderby.toLowerCase()){case "published":return new z(a);case "updated":return new H(a);case "title":return new G(a);default:return new z(a)}}function K(a){a=a.a;switch(a.printby.toLowerCase()){case "title":return new t(a);case "label":return new w(a);case "label.nameorder":return new A(a);case "label.contentsorder":return new x(a);default:return new t(a)}}F(window,"load",function(){P()});document.write('<div id="'+M+'" class="poststoc">LOAD DATA ...</div>');
function Q(a){var c,b,e;c=P();O?a.feed.entry&&0!=a.feed.entry.length&&(b=O.feed.entry,e=a.feed.entry,b=b.concat(e),O.feed.entry=b):O=a;if(c.a.maxResults<=c.b||!a.feed.entry||a.feed.entry&&0===a.feed.entry.length){for(a=document.getElementById(M);b=a.firstChild;)a.removeChild(b);c.sort(O);c.print(O)}else L(c)}var R=["garafu","blogger","toc","load"],S=this;R[0]in S||!S.execScript||S.execScript("var "+R[0]);for(var T;R.length&&(T=R.shift());)R.length||void 0===Q?S=S[T]?S[T]:S[T]={}:S[T]=Q;})();
